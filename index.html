<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    #PumpkingImage, #eyes {
        position: absolute; 
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
    }

</style>
<body>
    <img id="PumpkingImage" src="pumpkin.png" width="600px" height="auto">
    <canvas id="eyes" style="z-index: 2; width: 600px; height: auto;"></canvas>
</body>
<script>
    // Fix for bad looking canvas:
    // https://medium.com/wdstack/fixing-html5-2d-canvas-blur-8ebe27db07da
    const canvas = document.getElementById('eyes');
    const content = canvas.getContext("2d");
    const dpr = window.devicePixelRatio || 1;

    let style_height = +getComputedStyle(canvas).getPropertyValue("height").slice(0, -2); //get CSS width
    let style_width = +getComputedStyle(canvas).getPropertyValue("width").slice(0, -2);

    canvas.setAttribute('height', style_height * dpr);
    canvas.setAttribute('width', style_width * dpr);

    const randomEye = {
    0: 'eye_bored2.png',
    1: 'eye_haha.png',
    2: 'eye_hm.png',
    3: 'eye_mad.png',
    4: 'eye_normal.png',
    5: 'eye_really.png',
    6: 'eye_sad.png',
    7: 'eye_scared.png',
    8: 'eye_scared2.png',
    9: 'eye_verymad.png',
    10: 'eye_what.png',
    11: 'eye_woo.png'
    };

    x = `eyes/${randomEye[Math.floor(Math.random() * 11)]}`;
    const leftEye = new Image();
    leftEye.crossOrigin = 'anonymous';
    leftEye.src = x;

    leftEye.onload = () => {
        content.drawImage(leftEye, 100, canvas.height / 3 / dpr, 162, 202);
        setTimeout(() => {
            const rightEye = new Image();
            rightEye.crossOrigin = 'anonymous';
            rightEye.src = x;
            rightEye.onload = () => {
                content.save();
                content.translate(600, 0);
                content.scale(-1, 1);
                content.drawImage(rightEye, 100, canvas.height / 3 / dpr, 162, 202);
                content.restore();
            }
        }, 10);
    }

    let OldX = 0;
    let OldY = 0;
    let lastTime = Date.now();
    let EndOfAnEra = Date.now() + 10000;
    let CountingPixels = 0;

    const radius = 2;
    const size = radius * 2 + 1;

    canvas.addEventListener("mousemove", (e, timestamp) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        const now = Date.now();
        const dt = (now - lastTime) / 1000;

        // changed code reused from my old project
            const canvasX = x * dpr;
            const canvasY = y * dpr;

            /*
            if (EndOfAnEra - now <= 0) {
                console.log(CountingPixels);
                Glif.style.display = "none";
                return;
            }
                */
            

            const pixel = content.getImageData(canvasX - radius, canvasY - radius, size, size).data;
            
            let DarkPixel = false;
            for (let i = 0; i < pixel.length; i += 4) {
                const r = pixel[i];
                const g = pixel[i + 1];
                const b = pixel[i + 2];
                const a = pixel[i + 3];

                if (r < 10 && g < 10 && b < 10 && a > 128) {
                    CountingPixels += 1;
                    content.fillStyle = "rgb(255, 0, 0)";
                    content.beginPath();
                    content.arc(x, y, 5, 0, Math.PI * 2);
                    content.fill();
                    break;
                }
            }

            OldX = x;
            OldY = y;
            lastTime = now;
        });
</script>
</html>